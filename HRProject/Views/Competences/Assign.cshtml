@model HRProject.Models.AssignCompetenceViewModel

@{
    ViewData["Title"] = "Assign Competence";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
    /* HEADER: Modern Gradient */
    .header-bg {
        background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
        height: 200px;
        border-radius: 0 0 50% 50% / 20px;
        position: relative;
        margin-bottom: 3rem;
    }

    .header-content {
        position: absolute;
        bottom: 50px;
        width: 100%;
        text-align: center;
        color: white;
    }

    /* FLOATING CARD */
    .assign-card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        margin-top: 30px; /* pull it up slightly over header */
        overflow: hidden;
    }

    .card-header-custom {
        background-color: #fff;
        border-bottom: 1px solid #f0f0f0;
        padding: 1.5rem;
        text-align: center;
    }

    /* FORM CONTROLS */
    .input-group-text {
        background-color: #f8f9fa;
        border-right: none;
        color: #6c757d;
    }

    .form-control,
    .form-select {
        border-left: none;
        box-shadow: none !important;
        border-color: #dee2e6;
    }

    .input-group:focus-within {
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        border-radius: 0.375rem;
    }

        .input-group:focus-within .input-group-text,
        .input-group:focus-within .form-control,
        .input-group:focus-within .form-select {
            border-color: #86b7fe;
        }

    /* TABLE & BADGES */
    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }

    .badge-pill {
        padding: 0.5em 0.8em;
        border-radius: 50rem;
        font-weight: 500;
        font-size: 0.8rem;
        letter-spacing: 0.5px;
    }

    .badge-Basic {
        background-color: #e1f0ff;
        color: #0d6efd;
    }

    .badge-Intermediate {
        background-color: #fff3cd;
        color: #856404;
    }

    .badge-Advanced {
        background-color: #d1e7dd;
        color: #0f5132;
    }

    .empty-state {
        text-align: center;
        padding: 2rem;
        color: #adb5bd;
    }
</style>

<!-- HEADER -->
<div class="header-bg">
    <div class="header-content">
        <h2 class="fw-bold">
            <i class="bi bi-award me-2"></i>Assign Competence
        </h2>
        <p class="opacity-75">Manage user skills and proficiency levels</p>
    </div>
</div>

<div class="container mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-7 col-md-9">

            <div class="card assign-card bg-white">

                @* Success message *@
                @if (ViewBag.SuccessMessage != null)
                {
                    <div class="alert alert-success alert-dismissible fade show m-0 rounded-0 border-0" role="alert">
                        <i class="bi bi-check-circle-fill me-2"></i> @ViewBag.SuccessMessage
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                <div class="card-body p-4 p-md-5">

                    <form asp-action="Assign" asp-controller="UserCompetences" method="post" novalidate>
                        @Html.AntiForgeryToken()

                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                        <!-- User Email -->
                        <div class="mb-4">
                            <label asp-for="UserEmail" class="form-label text-muted small fw-bold text-uppercase">
                                Employee Email
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-envelope"></i>
                                </span>
                                <input asp-for="UserEmail" class="form-control" placeholder="name@company.com" />
                            </div>
                            <span asp-validation-for="UserEmail" class="text-danger small"></span>
                        </div>

                        <div class="row">
                            <!-- Competence -->
                            <div class="col-md-6 mb-4">
                                <label asp-for="CompetenceId" class="form-label text-muted small fw-bold text-uppercase">
                                    Competence
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bi bi-lightbulb"></i>
                                    </span>
                                    <select asp-for="CompetenceId"
                                            asp-items="Model.Competences"
                                            class="form-select">
                                        <option value="">Select...</option>
                                    </select>
                                </div>
                                <span asp-validation-for="CompetenceId" class="text-danger small"></span>
                            </div>

                            <!-- Level -->
                            <div class="col-md-6 mb-4">
                                <label asp-for="Level" class="form-label text-muted small fw-bold text-uppercase">
                                    Proficiency
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bi bi-bar-chart-steps"></i>
                                    </span>
                                    <select asp-for="Level"
                                            asp-items="Model.Levels"
                                            class="form-select">
                                        <option value="">Select...</option>
                                    </select>
                                </div>
                                <span asp-validation-for="Level" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- Years of Experience -->
                        <div class="mb-4">
                            <label asp-for="YearsOfExperience" class="form-label text-muted small fw-bold text-uppercase">
                                Experience (Years)
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-calendar3"></i>
                                </span>
                                <!-- step="1" -> increase by 1 year -->
                                <input asp-for="YearsOfExperience"
                                       type="number"
                                       min="0"
                                       step="1"
                                       class="form-control"
                                       placeholder="e.g. 2" />
                            </div>
                            <span asp-validation-for="YearsOfExperience" class="text-danger small"></span>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-between align-items-center mt-4">
                            <a asp-controller="Competences" asp-action="Index" class="text-decoration-none text-muted">
                                <i class="bi bi-arrow-left"></i> Back to List
                            </a>
                            <button type="submit" class="btn btn-primary px-5 rounded-pill shadow-sm">
                                Assign Competence
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Existing competences for this user -->
                <div class="bg-light p-4 border-top">
                    <h6 class="fw-bold text-muted mb-3">
                        <i class="bi bi-collection me-1"></i> Existing Competences
                    </h6>

                    @if (Model.ExistingUserCompetences != null && Model.ExistingUserCompetences.Any())
                    {
                        <div class="table-responsive bg-white rounded shadow-sm border">
                            <table class="table table-hover mb-0 align-middle">
                                <thead class="table-light">
                                    <tr class="text-muted small text-uppercase">
                                        <th class="ps-3">Skill</th>
                                        <th>Level</th>
                                        <th class="text-end pe-3">Exp.</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var uc in Model.ExistingUserCompetences)
                                    {
                                        <tr>
                                            <td class="ps-3 fw-medium">@uc.Competence?.Name</td>
                                            <td>
                                                <span class="badge badge-pill badge-@uc.Level">
                                                    @uc.Level
                                                </span>
                                            </td>
                                            <td class="text-end pe-3 text-muted">
                                                @(uc.YearsOfExperience.HasValue? uc.YearsOfExperience + "y" : "-")
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="empty-state">
                            <i class="bi bi-clipboard-x display-6 mb-2 d-block"></i>
                            <span class="small">No competences assigned to this user yet.</span>
                        </div>
                    }
                </div>

            </div>

        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
